---
title: 客户端最多能同时打开多少个页面？
date: 2017-08-18 21:11:39
tags:
- 系统原理
categories:
- 系统原理
---

如果忽略客户端机器的性能限制，一个客户端最多能同时打开多少个页面？乍一听时很懵逼，不知道什么套路。本文给出的答案是 64512。

![](https://img2.fanhaobai.com/2017/08/open-max-connect/3249e3f3-9e26-4a9a-b850-68baba3be257.png)<!--more-->

## 制约因素

我们知道，当确定协议后，TCP/IP 嵌套字是由`<source_ip, source_port, target_ip, target_port>`四元组唯一标识，即通信双方通过 ip 定位通信的机器，通过 port 定位通信的应用程序，服务端和客户端就是通过这种形式（端对端）进行数据的交互。

当客户端与服务端进行通信时且不考虑端口复用情况，由于源端口（客户端） ip 必然是唯一且确定，所以同时能建立的 TCP 嵌套字受 port 制约，进而影响着浏览器打开的网页数。

## 端口

### 端口数

一个系统提供的最大 port 数受端口号长度的限制，port 长度为 16 位，所以 port 个数为：2^16 = 65536。

### 端口使用规则

查看 Win 系统 port 使用情况：

```Bash
$ netstat -ano

活动连接
协议     本地地址             外部地址         状态       PID
TCP   0.0.0.0:445          0.0.0.0:0      LISTENING    4
TCP   0.0.0.0:902          0.0.0.0:0      LISTENING   4284
TCP 192.168.1.102:61389 123.57.32.54:443 ESTABLISHED  14208
... ...
```

可以发现，本地被使用的 port 有 445、902、61389 等这些值，查看下其使用程序：

```Bash
#端口号4情况
$ tasklist | findstr "4"
System          4    Services     0         16 K
services.exe   756   Services     0        6,344 K
lsass.exe      764   Services     0        14,068 K

#端口号14208情况
$ tasklist | findstr "14208"
chrome.exe     14208   Console     14    108,168 K
```

其实，系统默认会预留小于 1024 （445、902）的 port 为标准端口，1024 以上（61389）的 port 才会给应用程序使用，且一般会随机地进行分配。

## 答案

从以上分析可知，在不考虑客户端机器性能的前提下，一个客户端最多能同时打开的页面数等于最大可使用的端口数，即：65535（最大端口数）- 1024（系统预留端口数）= 64512。